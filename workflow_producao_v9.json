{
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.id }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "fe986919-fa3b-4d71-87b0-9b3b7b7ff2d8",
      "name": "√â Novo?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -4256,
        9984
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/ai/analyze",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { content: $node['Monitora FreshRSS'].json.title + ' ' + ($node['Monitora FreshRSS'].json.contentSnippet || ''), context: 'FreshRSS' } }}",
        "options": {}
      },
      "id": "d70046cd-7fae-4a5d-b2f1-50851db0ab97",
      "name": "IA Triagem",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -4032,
        9984
      ]
    },
    {
      "parameters": {
        "jsCode": "\nconst res = $input.first().json;\nreturn {\n  json: {\n    decisao: {\n      vale_video: res.relevant,\n      motivo: res.reasoning,\n      priority: res.priority || 'low'\n    }\n  }\n};\n"
      },
      "id": "29d89945-8711-48ea-a8f7-00af74e55516",
      "name": "Parse Triagem",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3808,
        9984
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $node['Parse Triagem'].json.decisao.vale_video }}",
              "value2": true
            }
          ]
        }
      },
      "id": "62dfdc2f-f067-4c48-ac1b-92a325173f0b",
      "name": "Vale V√≠deo?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -3584,
        9984
      ]
    },
    {
      "parameters": {
        "url": "=https://suggestqueries.google.com/complete/search?client=firefox&hl=pt&q={{ encodeURIComponent($node[\"Monitora FreshRSS\"].json.title) }}",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "f413ae5b-3ba0-4074-a249-38c8eda7ba58",
      "name": "Google Suggest",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -2016,
        9912
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "https://api.search.brave.com/res/v1/suggest/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $node[\"Monitora FreshRSS\"].json.title }}"
            },
            {
              "name": "count",
              "value": "10"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Subscription-Token",
              "value": "={{ $env[\"BRAVE_API_KEY\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "64ef357c-ac0b-4406-8729-053e4b76f2b1",
      "name": "Brave Suggestions",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1568,
        10128
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/enrich/sportsdb",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { query: $node[\"Monitora FreshRSS\"].json.title } }}",
        "options": {}
      },
      "alwaysOutputData": true,
      "id": "161caca7-64f7-4018-b2ce-a0f9ef3e3a1b",
      "name": "TheSportsDB",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -896,
        9984
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://ollama:11434/api/chat",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \n  model: 'llama3.2',\n  format: 'json',\n  stream: false,\n  messages: [\n    { \n      role: 'system', \n      content: 'Voc√™ √© um Roteirista e Narrador para o canal FUTEBAS - Not√≠cias de Futebol no YouTube Shorts e TikTok.\\n\\nüóìÔ∏è ANO ATUAL: 2026.\\n\\nüö´ PROIBI√á√ïES ABSOLUTAS:\\n- JAMAIS invente partidas, placares, les√µes ou transfer√™ncias.\\n- JAMAIS mencione COVID-19 ou eventos antes de 2024.\\n- JAMAIS use \"ao que tudo indica\" ou \"segundo boatos\".\\n- JAMAIS ultrapasse 350 palavras.\\n\\n‚úÖ ESTRUTURA OBRIGAT√ìRIA:\\n1. üéØ GANCHO EXPLOSIVO (0-3s): Frase impactante que prende o espectador.\\n2. üì∞ A NOT√çCIA REAL (3-20s): Fatos verific√°veis da not√≠cia fornecida.\\n3. ‚ö° O IMPACTO (20-45s): O que isso muda para o time/torcida/campeonato.\\n4. üì£ CTA (45-55s): Pergunta direta pedindo opini√£o nos coment√°rios.\\n\\nüì¶ FORMATO JSON OBRIGAT√ìRIO:\\n{\\n  \"roteiro\": \"Texto m√≠nimo 200 palavras, m√°x 350.\",\\n  \"titulo\": \"T√≠tulo viral m√°x 60 chars\",\\n  \"type\": \"Highlight|Noticia|Analise|Gol\",\\n  \"tags\": [\"tag1\",\"tag2\",\"tag3\"],\\n  \"mood\": \"Epic|Happy|Rock|Sad\"\\n}'\n    },\n    { \n      role: 'user', \n      content: 'NOT√çCIA:\\nT√≠tulo: ' + ($node[\"Monitora FreshRSS\"].json.title || \"Not√≠cia de futebol\") + '\\n\\nConte√∫do:\\n' + ($node[\"Leitor Trafilatura\"].json.texto_materia || $node[\"Monitora FreshRSS\"].json.contentSnippet || \"Sem conte√∫do\") + '\\n\\nSEO:\\n' + (($node[\"Google Suggest\"].json[1] ? $node[\"Google Suggest\"].json[1].join(\", \") : \"\") || \"futebol brasil\")\n    }\n  ]\n} }}",
        "options": {}
      },
      "id": "3ee23458-ead8-4f38-b12d-115a607a453b",
      "name": "IA Roteiro Master",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        224,
        9984
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "jsCode": "try {\n  let content = $input.first().json.message.content;\n  // Remove Markdown wrapper if present\n  content = content.replace(/```json/g, '').replace(/```/g, '').trim();\n  // Find first { and last }\n  const start = content.indexOf('{');\n  const end = content.lastIndexOf('}');\n  if (start !== -1 && end !== -1) {\n      content = content.substring(start, end + 1);\n  }\n  \n  const roteiro = JSON.parse(content);\n  \n  // Basic Validation\n  if (!roteiro.roteiro || roteiro.roteiro.length < 50) throw new Error('Roteiro muito curto ou inv√°lido');\n  \n  return { json: roteiro };\n} catch (e) {\n  // Safe Fallback - Avoid accessing specific nodes that might not exist\n  return {\n      json: {\n          roteiro: \"N√£o foi poss√≠vel gerar um roteiro detalhado. Assista aos melhores momentos no v√≠deo.\",\n          titulo: \"Resumo da Partida - Confira os Highlights\",\n          type: \"Highlight\",\n          is_fallback: true,\n          error: e.message\n      }\n  };\n}"
      },
      "id": "182d7467-5075-43ab-b95a-688d247d7036",
      "name": "Parse Roteiro",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        9984
      ]
    },
    {
      "parameters": {},
      "id": "5eea4cb3-ec17-4b1b-bda0-f4343b282c88",
      "name": "Merge Contexto Roteiro",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        -224,
        9984
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "images",
        "query": "={{ $json.titulo }}",
        "additionalParameters": {}
      },
      "id": "7349323b-f3ce-4c74-be2a-a55646b78aa8",
      "name": "Brave Images",
      "type": "@brave/n8n-nodes-brave-search.braveSearch",
      "typeVersion": 1,
      "position": [
        1120,
        9984
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "alwaysOutputData": true,
      "credentials": {
        "braveSearchApi": {
          "id": "WhhZ1MynDTqzt2wR",
          "name": "Brave Search account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "query": "={{ $json.titulo }} futebol not√≠cias",
        "additionalParameters": {}
      },
      "id": "95a1242c-94ef-45b2-ad3f-09d25e6b5274",
      "name": "Brave Web",
      "type": "@brave/n8n-nodes-brave-search.braveSearch",
      "typeVersion": 1,
      "position": [
        1344,
        9984
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "alwaysOutputData": true,
      "credentials": {
        "braveSearchApi": {
          "id": "WhhZ1MynDTqzt2wR",
          "name": "Brave Search account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "operation": "news",
        "query": "={{ $json.titulo }}",
        "additionalParameters": {}
      },
      "type": "@brave/n8n-nodes-brave-search.braveSearch",
      "typeVersion": 1,
      "position": [
        1568,
        9984
      ],
      "id": "44613562-6d73-494c-8d6a-2b2229f11bdb",
      "name": "Brave News",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "braveSearchApi": {
          "id": "WhhZ1MynDTqzt2wR",
          "name": "Brave Search account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "operation": "videos",
        "query": "={{ $json.titulo }}",
        "additionalParameters": {}
      },
      "type": "@brave/n8n-nodes-brave-search.braveSearch",
      "typeVersion": 1,
      "position": [
        1792,
        9984
      ],
      "id": "e9de9486-6c64-4588-ab9f-a105e8c8253e",
      "name": "Brave Videos",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "braveSearchApi": {
          "id": "WhhZ1MynDTqzt2wR",
          "name": "Brave Search account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/images",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{ $env[\"SERPER_API_KEY\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { q: $json.titulo, gl: 'br', num: 10 } }}",
        "options": {}
      },
      "id": "93a98f43-ee90-4891-93e2-6a93a2ede3b0",
      "name": "Serper.dev (Images)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2016,
        9984
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "https://free-football-soccer-videos.p.rapidapi.com/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-RapidAPI-Key",
              "value": "={{ $env[\"RAPIDAPI_KEY\"] }}"
            },
            {
              "name": "x-rapidapi-host",
              "value": "free-football-soccer-videos.p.rapidapi.com"
            }
          ]
        },
        "options": {}
      },
      "id": "e1c98f1c-1c5d-4c42-bf3d-b66b458e5c84",
      "name": "Gaveta VIP (Embeds)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2240,
        9984
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {},
      "id": "29fa9885-a98e-447c-b683-07016015512b",
      "name": "Merge Assets",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        4032,
        9888
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const all_images = [];\nconst all_videos = [];\nconst all_news = [];\n\nconst nodesToCheck = [\"Serper Search\", \"Brave Images\", \"Brave Web\", \"Brave News\", \"Brave Videos\", \"Serper.dev (Images)\", \"Gaveta VIP (Embeds)\", \"Serper News\", \"Serper Videos\", \"Tavily AI\", \"Pexels API\", \"Pixabay API\", \"SearXNG\", \"IA Metadata\"];\n\nnodesToCheck.forEach(nodeName => {\n    try {\n        const nodeOutput = $(nodeName).first();\n        if (nodeOutput && nodeOutput.json) {\n            const data = nodeOutput.json;\n            \n            // --- SERPER SEARCH (WEB) ---\n            if (data.organic && Array.isArray(data.organic)) {\n                data.organic.forEach(i => {\n                    if (i && i.link) all_news.push({ title: i.title, url: i.link });\n                });\n            }\n\n            // --- IA Metadata ---\n            if (data.tags) all_news.push({ tags: data.tags, trending: data.trending_sound });\n\n            // --- GOOGLE/SERPER/GENERIC IMAGES ---\n            if (data.images && Array.isArray(data.images)) {\n                data.images.forEach(img => {\n                    const url = (typeof img === 'object') ? (img.imageUrl || img.originalImageUrl || img.link) : img;\n                    if (typeof url === 'string') all_images.push(url);\n                });\n            }\n\n            // --- TAVILY RESULTS (News) ---\n            if (data.results && Array.isArray(data.results) && !data.organic) { \n               data.results.forEach(r => { \n                   if (r.img_src) all_images.push(r.img_src);\n                   else if (r.url && (r.url.endsWith('.jpg') || r.url.endsWith('.png'))) all_images.push(r.url);\n                   if (r.title && r.url && !r.img_src) all_news.push({ title: r.title, url: r.url });\n               });\n            }\n\n            // --- PEXELS API ---\n            if (data.videos && Array.isArray(data.videos)) {\n              data.videos.forEach(v => {\n                  if (v && v.video_files && Array.isArray(v.video_files)) {\n                      const hdFiles = v.video_files.filter(f => f && f.width >= 1280);\n                      if (hdFiles.length > 0) all_videos.push(hdFiles[0].link);\n                      else if (v.video_files.length > 0) all_videos.push(v.video_files[0].link);\n                  }\n              });\n            }\n\n            // --- PIXABAY API ---\n            if (data.hits && Array.isArray(data.hits)) {\n              data.hits.forEach(h => {\n                  if (h && h.videos && h.videos.medium && h.videos.medium.url) {\n                      all_videos.push(h.videos.medium.url);\n                  }\n              });\n            }\n\n            // --- BRAVE SEARCH (Images/Videos/News) ---\n            if (data.results && Array.isArray(data.results)) {\n                 data.results.forEach(r => {\n                    if (r) {\n                        if ((r.url && (r.url.endsWith('jpg') || r.url.endsWith('png'))) || r.thumbnail) {\n                            all_images.push(r.url || r.thumbnail);\n                        }\n                        if (r.url && r.title && !r.video) {\n                             all_news.push({ title: r.title, url: r.url });\n                        }\n                        if (r.video || (r.url && r.url.includes('youtube'))) {\n                             if (r.url) all_videos.push(r.url);\n                        }\n                    }\n                 });\n            }\n        }\n    } catch(e) { }\n});\n\n// Remove duplicatas e limpa\nconst unique_images = [...new Set(all_images.filter(Boolean))];\nconst unique_videos = [...new Set(all_videos.filter(Boolean))];\nconst unique_news = [...new Map(all_news.filter(Boolean).map(item => [item.url, item])).values()];\n\nif (unique_images.length === 0) {\n    unique_images.push('https://dummyimage.com/1280x720/000/fff.jpg&text=No+Image+Found');\n}\n\nlet roteiroType = 'unknown';\ntry {\n    const parseNode = $(\"Parse Roteiro\");\n    if (parseNode && parseNode.first()) {\n        roteiroType = parseNode.first().json.type || 'unknown';\n    }\n} catch(e) {}\n\nreturn { \n  json: { \n    assets: { \n      all_images: unique_images, \n      all_videos: unique_videos, \n      all_news: unique_news.slice(0, 10),\n      type: roteiroType\n    } \n  } \n};"
      },
      "id": "10d02dd9-0d69-46e1-9f71-3c2cd1fa2acb",
      "name": "Agrupador Master Assets",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4256,
        9888
      ]
    },
    {
      "parameters": {
        "url": "={{ $node['Agrupador Master Assets'].json.assets.all_images[0] || 'https://via.placeholder.com/1280x720' }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {
              "maxRedirects": 5
            }
          }
        }
      },
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 3000,
      "id": "7fb615c6-65dd-4956-b1a5-d6b496fb4817",
      "name": "Baixa Capa",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        4480,
        9888
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/jobs/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \n  title: $node['Parse Roteiro'].json.titulo || $node['Monitora FreshRSS'].json.title || \"Not√≠cia de Futebol\", \n  script: $node['Parse Roteiro'].json.roteiro || \"Assista aos melhores momentos.\", \n  type: ($node['Parse Roteiro'].json.type || 'Highlight'), \n  assets: $node['Agrupador Master Assets'].json.assets, \n  config: { \n    slide1: 'cutout', \n    slide2: (($node['Parse Roteiro'].json.type || 'Highlight') === 'Highlight' ? 'video_4s_zoom' : 'image'), \n    slide3: 'video_4s_zoom' \n  }, \n  source_url: $node['Monitora FreshRSS'].json.link, \n  pub_date: $node['Monitora FreshRSS'].json.isoDate \n} }}",
        "options": {
          "timeout": 300000
        }
      },
      "id": "fb6c8eb0-19fb-4aed-8605-43afe7cc05cc",
      "name": "Gera V√≠deo H√≠brido",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "position": [
        4928,
        9888
      ]
    },
    {
      "parameters": {
        "url": "={{ $node[\"Monitora FreshRSS\"].json.link }}",
        "options": {
          "allowUnauthorizedCerts": false,
          "redirect": {
            "redirect": {
              "maxRedirects": 10
            }
          },
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "text",
              "outputPropertyName": "texto_materia"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -3136,
        9984
      ],
      "id": "8ee8e101-0ae1-4112-a3e6-e40bc6804b4c",
      "name": "Descobre Link Real"
    },
    {
      "parameters": {
        "jsCode": "// CORRE√á√ÉO: Alterado de 'Leitor Jina' para '$input' (gen√©rico) e 'Leitor Trafilatura')\nconst entrada = $input.first().json;\n\n// L√≥gica de Fallback de Texto (CR√çTICO)\n// Se Trafilatura vier vazio ou muito curto (<50 chars), usa o Snippet do RSS\nlet texto_traf = ($node[\"Leitor Trafilatura\"] && $node[\"Leitor Trafilatura\"].json.texto_materia) || \"\";\nif (texto_traf.length < 50) {\n    texto_traf = $node[\"Monitora FreshRSS\"].json.contentSnippet || $node[\"Monitora FreshRSS\"].json.content || \"\";\n}\n\nconst materia = texto_traf;\n\n// 1. Extrai imagens (jpg, png, etc.)\nconst imagemMatches = materia.matchAll(/https?:\\/\\/.*?\\.(jpg|png|jpeg|gif)/ig);\nlet imagens = Array.from(imagemMatches, m => m[0]).slice(0, 5);\n\n// 2. Extrai v√≠deos (mp4, YouTube links)\nconst videoMatches = materia.matchAll(/https?:\\/\\/.*?\\.(mp4|webm)|youtu\\.be\\/[a-zA-Z0-9_-]+|youtube\\.com\\/watch\\?v=[a-zA-Z0-9_-]+/ig);\nlet videos = Array.from(videoMatches, m => m[0]).slice(0, 3);\n\n// 3. Define imagem principal (Prioridade: Trafilatura > Regex > Placeholder)\nconst imagem_principal =\n  entrada.imagem_principal ||\n  ($node[\"Leitor Trafilatura\"] && $node[\"Leitor Trafilatura\"].json.imagem_principal) ||\n  imagens[0] ||\n  'https://via.placeholder.com/1280x720?text=Sem+Imagem';\n\nreturn { json: { imagens, videos, imagem_principal, texto_materia: materia } };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2464,
        9984
      ],
      "id": "a7cbfcd2-9e44-4d5b-b45b-0dd6d2e472f8",
      "name": "Extrai Midias"
    },
    {
      "parameters": {
        "jsCode": "const html = $node[\"Descobre Link Real\"].json.texto_materia;\n\n// Regex para extrair o link real do artigo (Google News usa <a href=\"...\" class=\"...\"> ou meta)\nconst linkMatch = html.match(/<a[^>]*href=\"([^\"]*?)\"[^>]*class=\"[^\"]*?article[^\"]*\"/i) ||\n                  html.match(/<link rel=\"canonical\" href=\"([^\"]*)\"/i) ||\n                  html.match(/window\\.location\\.replace\\(\"([^\"]*)\"\\)/i);\n\nconst linkReal = linkMatch ? linkMatch[1] : $node[\"Monitora FreshRSS\"].json.link; // Fallback para o original se n√£o achar\n\nreturn { json: { link_real: decodeURIComponent(linkReal) } };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2912,
        9984
      ],
      "id": "3fb3663b-4264-49a6-98a7-1ab1a182b2b2",
      "name": "Extrai Link Real do Google"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/extract/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { url: $node[\"Monitora FreshRSS\"].json.link } }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -2688,
        9984
      ],
      "id": "7fff6139-4fed-4080-b8fb-1b7c1669569a",
      "name": "Leitor Trafilatura"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{ $env[\"SERPER_API_KEY\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { q: $json.titulo, gl: 'br', num: 5 } }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        896,
        9984
      ],
      "id": "b7e10ba2-376c-4825-8459-e1e40a38632e",
      "name": "Serper Search",
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const input = $input.all();\nconst groups = {\n  premier_league: [],\n  la_liga: [],\n  serie_a: [],\n  brasileirao: [],\n  outros: []\n};\n\ninput.forEach(item => {\n  const video = item.json;\n  \n  // Extrai o nome da competi√ß√£o de forma segura, seja texto ou objeto\n  let competitionString = \"\";\n  if (video.competition) {\n      if (typeof video.competition === 'string') {\n          competitionString = video.competition;\n      } else if (video.competition.name) {\n          competitionString = video.competition.name;\n      } else {\n          competitionString = JSON.stringify(video.competition); // Fallback final\n      }\n  }\n  \n  const competition = competitionString.toLowerCase();\n  \n  if (competition.includes('premier league') || competition.includes('england')) groups.premier_league.push(video);\n  else if (competition.includes('la liga') || competition.includes('spain')) groups.la_liga.push(video);\n  else if (competition.includes('serie a') || competition.includes('italy')) groups.serie_a.push(video);\n  else if (competition.includes('brasileir√£o') || competition.includes('brazil') || competition.includes('brasil')) groups.brasileirao.push(video);\n  else groups.outros.push(video);\n});\n\nreturn { json: groups };"
      },
      "id": "176ce63a-0ee0-43e6-8399-9165c994ad5a",
      "name": "Filtra Ligas (Telegram)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2464,
        10080
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "7ab0343d-12d3-4ff1-830b-2bf02343969b",
      "name": "Envio Telegram Gols",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        2688,
        10080
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5679/webhook/8805f345-6dd0-4fa4-a231-851ca3fbf0af",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { executionId: $execution.id } }}",
        "options": {}
      },
      "id": "9db59811-91b0-49e1-9e8a-4b4567cec3f6",
      "name": "Log Execution",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2912,
        10080
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/media/scorebat",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { team1: $node['Monitora FreshRSS'].json.title.split(' x ')[0] || $node['Monitora FreshRSS'].json.title.split(' vs ')[0] || $node['Monitora FreshRSS'].json.title, team2: $node['Monitora FreshRSS'].json.title.split(' x ')[1] || $node['Monitora FreshRSS'].json.title.split(' vs ')[1] || '' } }}",
        "options": {}
      },
      "alwaysOutputData": true,
      "id": "612235a8-9730-4c6f-9a3a-80bc9da5c5cf",
      "name": "ScoreBat (Python)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1120,
        9984
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/media/reddit",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { query: $node['Monitora FreshRSS'].json.title, flair: 'Media' } }}",
        "options": {}
      },
      "alwaysOutputData": true,
      "id": "3c2a7b47-5854-4a05-b4f2-f3545e2fb4fc",
      "name": "Social Scraper (Python)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -672,
        9984
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/enrich/transfermarkt",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { query: $node[\"Monitora FreshRSS\"].json.title } }}",
        "options": {}
      },
      "alwaysOutputData": true,
      "id": "3c5be522-2857-4420-948a-24e9e82b6368",
      "name": "Transfermarkt (Python)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -448,
        9984
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/news",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{ $env[\"SERPER_API_KEY\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { q: $json.titulo, gl: 'br', num: 5 } }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.4,
      "position": [
        2464,
        9888
      ],
      "id": "d097d9fd-dd3b-4467-a823-0bd111abefa2",
      "name": "Serper News",
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/videos",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{ $env[\"SERPER_API_KEY\"] }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { q: $json.titulo + ' melhores momentos', gl: 'br', num: 10 } }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.4,
      "position": [
        2688,
        9888
      ],
      "id": "a345efcf-687f-4f0c-bc9e-e999d6d40f5c",
      "name": "Serper Videos",
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.tavily.com/search",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"api_key\": $env[\"TAVILY_API_KEY\"],\n  \"query\": $json.titulo,\n  \"search_depth\": \"basic\",\n  \"include_images\": true,\n  \"include_answer\": true,\n  \"max_results\": 5\n} }}",
        "options": {}
      },
      "id": "eb9ad8e4-6025-4ca9-a9c7-cd9f00ed59cc",
      "name": "Tavily AI",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2912,
        9888
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "https://api.pexels.com/videos/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ $json.titulo.includes('futebol') ? 'soccer fans stadium' : 'football soccer match' }}"
            },
            {
              "name": "per_page",
              "value": "5"
            },
            {
              "name": "orientation",
              "value": "landscape"
            },
            {
              "name": "size",
              "value": "medium"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $env[\"PEXELS_API_KEY\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7e60d777-6815-4f86-b03b-a6e13c636aeb",
      "name": "Pexels API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3136,
        9888
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "https://pixabay.com/api/videos/",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "={{ $env[\"PIXABAY_API_KEY\"] }}"
            },
            {
              "name": "q",
              "value": "football soccer"
            },
            {
              "name": "video_type",
              "value": "film"
            },
            {
              "name": "per_page",
              "value": "5"
            }
          ]
        },
        "options": {}
      },
      "id": "92d4858b-7182-4136-b835-e378e94265d7",
      "name": "Pixabay API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3360,
        9888
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "http://searxng:8080/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $json.titulo }}"
            },
            {
              "name": "format",
              "value": "json"
            },
            {
              "name": "categories",
              "value": "images"
            },
            {
              "name": "engines",
              "value": "google_images,bing_images"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Real-IP",
              "value": "127.0.0.1"
            }
          ]
        },
        "options": {}
      },
      "id": "e34c323f-c350-4c07-8716-42be49f52b3e",
      "name": "SearXNG",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3584,
        9888
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "b9309011-8233-45a3-8456-aa9961dfb2b5",
      "name": "Definir Prioridade",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        -3360,
        9984
      ]
    },
    {
      "parameters": {
        "amount": "={{ Math.floor(Math.random() * (120 - 30 + 1) + 30) }}",
        "unit": "seconds"
      },
      "id": "edea4963-3f09-44b7-8fa6-74cb30eeef35",
      "name": "Espera Randomica",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        4704,
        9888
      ],
      "webhookId": "39b9c82b-7925-40e4-b14c-c193b5a62377"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/publish/multi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "video_path",
              "value": "={{ $json.video_path }}"
            },
            {
              "name": "title",
              "value": "={{ $node['IA Metadata'].isExecuted ? $node['IA Metadata'].json.title : $node['Parse Roteiro'].json.titulo }}"
            },
            {
              "name": "description",
              "value": "={{ $node['IA Metadata'].isExecuted ? ($node['IA Metadata'].json.description || $node['Parse Roteiro'].json.hook || 'V√≠deo Novo!') : ($node['Parse Roteiro'].json.hook || 'V√≠deo Novo!') }}"
            },
            {
              "name": "platforms",
              "value": "={{ ['youtube', 'tiktok'] }}"
            },
            {
              "name": "privacy",
              "value": "private"
            },
            {
              "name": "hashtags",
              "value": "={{ ($node['IA Metadata'].isExecuted && $node['IA Metadata'].json.tags) ? $node['IA Metadata'].json.tags : [] }}"
            },
            {
              "name": "job_id",
              "value": "={{ $node['Gera V√≠deo H√≠brido'].json.job_id }}"
            }
          ]
        },
        "options": {
          "timeout": 900000
        }
      },
      "id": "49ec3f45-82ea-485f-8281-d1e498419eef",
      "name": "Publica Multi",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6496,
        9888
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "={{ 'http://python_service:8000/jobs/' + $node['Gera V√≠deo H√≠brido'].json.job_id }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => { const results = $json.results || {}; const youtubeOk = results.youtube?.status === 'success'; const tiktokOk = results.tiktok?.status === 'success'; const published = youtubeOk || tiktokOk; return { status: published ? 'published' : 'failed', published, metadata_post: results, error_message: published ? null : 'Falha em todas as plataformas de publica√ß√£o' }; })() }}",
        "options": {}
      },
      "id": "48bd5794-49bb-4388-ba55-19e341c1812a",
      "name": "Update DB Final",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        7168,
        9888
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/ai/metadata",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \n  model: 'llama3.2',\n  format: 'json',\n  stream: false,\n  messages: [\n    { \n      role: 'system', \n      content: 'Voc√™ √© Especialista em SEO para YouTube Shorts e TikTok do canal FUTEBAS.\\n\\nüö´ N√£o invente. Retorne APENAS o JSON.\\n\\nDESCRIPTION: m√°x 280 chars, sem hashtags, termina em emoji.\\nTAGS: exatamente 15, come√ßando com #Futebol #Shorts #Futebas.\\n\\nüì¶ JSON OBRIGAT√ìRIO:\\n{\\n  \"description\": \"at√© 280 chars terminando em emoji üî•\",\\n  \"tags\": [\"#Futebol\",\"#Shorts\",\"#Futebas\",\"...mais 12 hashtags\"]\\n}'\n    },\n    {\n      role: 'user',\n      content: 'T√≠tulo: ' + ($node[\"Parse Roteiro\"].json.titulo || $node[\"Monitora FreshRSS\"].json.title || \"Futebol\") + '\\n\\nRoteiro:\\n' + (($node[\"Parse Roteiro\"].json.roteiro || \"\").substring(0, 500))\n    }\n  ]\n} }}",
        "options": {
          "timeout": 300000
        }
      },
      "id": "79866a8f-b3a8-442a-832c-cfdda32684e9",
      "name": "IA Metadata",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "position": [
        3808,
        9888
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "amount": "={{ Math.floor(Math.random() * 10) + 5 }}",
        "unit": "seconds"
      },
      "id": "3303362e-0a14-4411-9354-0e2e522b9406",
      "name": "Delay Rate Limit",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        -2240,
        9984
      ],
      "webhookId": "c3c6ac66-121d-4304-8aca-cc83ff962ed3"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $input.item.error }}",
              "operation": "isNotEmpty"
            },
            {
              "value1": "={{ $node['Google Suggest'].json }}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "6991e472-66f1-48f2-a20d-833ac699e42e",
      "name": "IF Erro Suggest",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -1792,
        9912
      ]
    },
    {
      "parameters": {
        "jsCode": "const title = ($input.item.json && $input.item.json.title) ? $input.item.json.title : 'Assunto Viral';\nreturn [\n  {\n    json: {\n      title: title,\n      suggestions: ['futebol brasil', 'noticias virais', title + ' gols']\n    }\n  }\n];"
      },
      "id": "9459e306-30d0-45d3-9cd5-3ffabfb36892",
      "name": "Mock Suggestions",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1568,
        9840
      ]
    },
    {
      "parameters": {
        "amount": 30,
        "unit": "seconds"
      },
      "id": "54729947-8ca3-42ac-ae5a-c21ba5a543eb",
      "name": "Wait for Job",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        5152,
        9888
      ],
      "webhookId": "63d47d43-de57-474f-9bda-b83e8c554c72"
    },
    {
      "parameters": {
        "url": "={{ 'http://python_service:8000/jobs/' + $node['Gera V√≠deo H√≠brido'].json.job_id }}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "79536ffa-6474-4bfe-9e40-90538d90a03a",
      "name": "Check Job Status",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        5376,
        9816
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.status }}",
              "operation": "notEqual",
              "value2": "processing"
            }
          ],
          "number": [
            {
              "value1": "={{ $json.attempts || 0 }}",
              "operation": "largerEqual",
              "value2": 20
            }
          ]
        }
      },
      "id": "332c9795-2de1-4c2f-87f7-2e9ef4c31ee3",
      "name": "Job Finished?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        5824,
        9888
      ]
    },
    {
      "parameters": {
        "jsCode": "const previousAttempts = Number($node['Wait for Job']?.json?.attempts || 0);\nconst attempts = previousAttempts + 1;\nreturn { json: { ...$json, attempts } };"
      },
      "id": "90b9d285-005e-4640-9356-31a75f17eeec",
      "name": "Increment Attempts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5600,
        9816
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.attempts >= 20 && $json.status === 'processing' }}",
              "value2": true
            }
          ]
        }
      },
      "id": "7758f3a6-3ed3-42c6-b73d-22595037c361",
      "name": "Is Timeout?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        6048,
        9888
      ]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "={{ 'http://python_service:8000/jobs/' + $node['Gera V√≠deo H√≠brido'].json.job_id }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { status: 'timeout', error_message: 'Job timed out in n8n (20 attempts)', updated_at: new Date().toISOString() } }}",
        "options": {}
      },
      "id": "9477ea81-d485-449f-a397-d70785d4f983",
      "name": "Mark Timeout",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6272,
        9792
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.status }}",
              "operation": "regex",
              "value2": "completed|published"
            }
          ]
        }
      },
      "id": "deed7099-dbb1-4d6f-bbf3-7ef307da0dc5",
      "name": "Job Succeeded?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        6272,
        9984
      ]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "={{ 'http://python_service:8000/jobs/' + $node['Gera V√≠deo H√≠brido'].json.job_id }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { status: ($json.status || 'failed'), published: false, error_message: $json.error_message || 'Job finalizado sem status completed; publica√ß√£o bloqueada no workflow.' } }}",
        "options": {}
      },
      "id": "3b281bb8-5d20-4434-8e4e-0dc17134c715",
      "name": "Mark Job Failed",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6496,
        10080
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ ($json.results && $json.results.tiktok && $json.results.tiktok.status === 'error') || $json.platforms.includes('manual') }}",
              "value2": true
            }
          ]
        }
      },
      "id": "2ae60b5e-a5b3-4db7-98fd-99591fd63c06",
      "name": "If TikTok Error",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        6720,
        9888
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot{{ $env.TELEGRAM_TOKEN }}/sendMessage",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "{{ $env.TELEGRAM_CHAT_ID }}"
            },
            {
              "name": "text",
              "value": "?? **Falha no Auto-Post (ou Manual Required)** ??\n\n?? **T√≠tulo:** {{ $node['IA Metadata'].isExecuted ? $node['IA Metadata'].json.title : $node['Parse Roteiro'].json.titulo }}\n??? **Hashtags:** {{ ($node['IA Metadata'].isExecuted && $node['IA Metadata'].json.tags ? $node['IA Metadata'].json.tags : []).join(' ') }}\n?? **V√≠deo:** `{{ $json.video_path }}`\n\n?? *O TikTok retornou erro ou o envio foi marcado como manual.*\n?? [Clique para Postar Manualmente](https://www.tiktok.com/upload?lang=pt-BR)"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "0cf916bb-5e5e-4dd2-b4fb-4e259d079677",
      "name": "Notifica Telegram Manual Post",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        6944,
        9816
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const all_suggestions = new Set();\nlet original_title = '';\nlet original_data = {};\n\n// Tenta pegar o t√É¬≠tulo original do Monitora FreshRSS (Mais seguro que input direto)\ntry {\n    if ($('Monitora FreshRSS').first()) {\n        original_title = $('Monitora FreshRSS').first().json.title;\n        original_data = $('Monitora FreshRSS').first().json;\n    }\n} catch(e) {}\n\n// Iterate over all inputs from Google, Brave, Mock\n$input.all().forEach(item => {\n    const json = item.json;\n    if (!json) return;\n    \n    // Tenta pegar title do input se falhar em cima\n    if (!original_title && json.title) original_title = json.title;\n\n    // Format 1: OpenSearch (Google/Brave)\n    if (Array.isArray(json) && json.length > 1 && Array.isArray(json[1])) {\n        json[1].forEach(s => all_suggestions.add(s));\n    }\n    \n    // Format 2: JSON Object with '1'\n    if (json['1'] && Array.isArray(json['1'])) {\n        json['1'].forEach(s => all_suggestions.add(s));\n    }\n    \n    // Format 3: Explicit suggestions key\n    if (json.suggestions && Array.isArray(json.suggestions)) {\n        json.suggestions.forEach(s => all_suggestions.add(s));\n    }\n});\n\nreturn {\n    json: {\n        ...original_data,\n        title: original_title,\n        suggestions: Array.from(all_suggestions)\n    }\n};"
      },
      "id": "a3de9ac6-6a2e-4e1b-b9ad-dd242ba35c2e",
      "name": "Merge Suggest",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1344,
        9984
      ],
      "alwaysOutputData": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "eb00ff20-4966-407f-90cc-08723bcc4160",
      "name": "Force Merge Context",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        0,
        9984
      ]
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "id": "5df2553b-30fe-4de9-a42f-775c04179afd",
      "name": "Cron (10min)",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        -4704,
        9984
      ]
    },
    {
      "parameters": {
        "url": "http://freshrss/i/?a=rss&user=dudu524&token=n8n2026&hours=24",
        "options": {}
      },
      "id": "18e46b08-861f-4459-93c2-8d8e61f2d69b",
      "name": "Monitora FreshRSS",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [
        -4480,
        9984
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "titulo",
              "value": "={{ $json.titulo }}"
            },
            {
              "name": "roteiro",
              "value": "={{ $json.roteiro }}"
            },
            {
              "name": "type",
              "value": "={{ $json.type }}"
            },
            {
              "name": "tags",
              "value": "={{ $json.tags }}"
            }
          ]
        },
        "options": {}
      },
      "id": "a67e8de5-10a3-4295-af1a-705659d84890",
      "name": "Broadcast Hub",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        672,
        9984
      ],
      "alwaysOutputData": true
    }
  ],
  "connections": {
    "√â Novo?": {
      "main": [
        [
          {
            "node": "IA Triagem",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IA Triagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IA Triagem": {
      "main": [
        [
          {
            "node": "Parse Triagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Triagem": {
      "main": [
        [
          {
            "node": "Vale V√≠deo?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vale V√≠deo?": {
      "main": [
        [
          {
            "node": "Definir Prioridade",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Definir Prioridade",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Suggest": {
      "main": [
        [
          {
            "node": "IF Erro Suggest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Brave Suggestions": {
      "main": [
        [
          {
            "node": "Merge Suggest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TheSportsDB": {
      "main": [
        [
          {
            "node": "Social Scraper (Python)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IA Roteiro Master": {
      "main": [
        [
          {
            "node": "Parse Roteiro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Roteiro": {
      "main": [
        [
          {
            "node": "Broadcast Hub",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Contexto Roteiro": {
      "main": [
        [
          {
            "node": "Force Merge Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Brave Images": {
      "main": [
        [
          {
            "node": "Brave Web",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Brave Web": {
      "main": [
        [
          {
            "node": "Brave News",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Brave News": {
      "main": [
        [
          {
            "node": "Brave Videos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Brave Videos": {
      "main": [
        [
          {
            "node": "Serper.dev (Images)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Serper.dev (Images)": {
      "main": [
        [
          {
            "node": "Gaveta VIP (Embeds)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gaveta VIP (Embeds)": {
      "main": [
        [
          {
            "node": "Serper News",
            "type": "main",
            "index": 0
          },
          {
            "node": "Filtra Ligas (Telegram)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Assets": {
      "main": [
        [
          {
            "node": "Agrupador Master Assets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agrupador Master Assets": {
      "main": [
        [
          {
            "node": "Baixa Capa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Baixa Capa": {
      "main": [
        [
          {
            "node": "Espera Randomica",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gera V√≠deo H√≠brido": {
      "main": [
        [
          {
            "node": "Wait for Job",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Descobre Link Real": {
      "main": [
        [
          {
            "node": "Extrai Link Real do Google",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extrai Midias": {
      "main": [
        [
          {
            "node": "Delay Rate Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extrai Link Real do Google": {
      "main": [
        [
          {
            "node": "Leitor Trafilatura",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Leitor Trafilatura": {
      "main": [
        [
          {
            "node": "Extrai Midias",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Serper Search": {
      "main": [
        [
          {
            "node": "Brave Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtra Ligas (Telegram)": {
      "main": [
        [
          {
            "node": "Envio Telegram Gols",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envio Telegram Gols": {
      "main": [
        [
          {
            "node": "Log Execution",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ScoreBat (Python)": {
      "main": [
        [
          {
            "node": "TheSportsDB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Social Scraper (Python)": {
      "main": [
        [
          {
            "node": "Transfermarkt (Python)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transfermarkt (Python)": {
      "main": [
        [
          {
            "node": "Merge Contexto Roteiro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Serper News": {
      "main": [
        [
          {
            "node": "Serper Videos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Serper Videos": {
      "main": [
        [
          {
            "node": "Tavily AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tavily AI": {
      "main": [
        [
          {
            "node": "Pexels API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pexels API": {
      "main": [
        [
          {
            "node": "Pixabay API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pixabay API": {
      "main": [
        [
          {
            "node": "SearXNG",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SearXNG": {
      "main": [
        [
          {
            "node": "IA Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Definir Prioridade": {
      "main": [
        [
          {
            "node": "Descobre Link Real",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espera Randomica": {
      "main": [
        [
          {
            "node": "Gera V√≠deo H√≠brido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publica Multi": {
      "main": [
        [
          {
            "node": "If TikTok Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IA Metadata": {
      "main": [
        [
          {
            "node": "Merge Assets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delay Rate Limit": {
      "main": [
        [
          {
            "node": "Google Suggest",
            "type": "main",
            "index": 0
          },
          {
            "node": "Brave Suggestions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Erro Suggest": {
      "main": [
        [
          {
            "node": "Mock Suggestions",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Suggest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mock Suggestions": {
      "main": [
        [
          {
            "node": "Merge Suggest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Job": {
      "main": [
        [
          {
            "node": "Check Job Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Job Status": {
      "main": [
        [
          {
            "node": "Increment Attempts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Job Finished?": {
      "main": [
        [
          {
            "node": "Is Timeout?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait for Job",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Increment Attempts": {
      "main": [
        [
          {
            "node": "Job Finished?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Timeout?": {
      "main": [
        [
          {
            "node": "Mark Timeout",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Job Succeeded?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Job Succeeded?": {
      "main": [
        [
          {
            "node": "Publica Multi",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mark Job Failed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If TikTok Error": {
      "main": [
        [
          {
            "node": "Notifica Telegram Manual Post",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update DB Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notifica Telegram Manual Post": {
      "main": [
        [
          {
            "node": "Update DB Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Suggest": {
      "main": [
        [
          {
            "node": "ScoreBat (Python)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Force Merge Context": {
      "main": [
        [
          {
            "node": "IA Roteiro Master",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cron (10min)": {
      "main": [
        [
          {
            "node": "Monitora FreshRSS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Monitora FreshRSS": {
      "main": [
        [
          {
            "node": "√â Novo?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Broadcast Hub": {
      "main": [
        [
          {
            "node": "Serper Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3812d373830822120641f24942341cb1c44f224eadbf0c02c4eadaa9c57e8918"
  }
}